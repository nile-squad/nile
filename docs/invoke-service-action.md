# How to use `invokeServiceAction`

The `invokeServiceAction` function is a type-safe way to interact with the backend API. It uses generated schemas to ensure that the correct payload is sent for each service and action.

## Usage

To use `invokeServiceAction`, you need to provide a `serviceName`, an `action`, and a `payload`.

```typescript
import { invokeServiceAction } from '@/api/invoke-service-action';
import { toast } from 'sonner';

try {
  const result = await invokeServiceAction({
    serviceName: 'data-service',
    action: 'getDashboardData',
    payload: {}, // No payload needed for this action
  });
  console.log(result);
} catch (error) {
  if (error instanceof Error) {
    toast.error(error.message);
  }
}
```

The `serviceName` and `action` are validated at runtime, and the `payload` is type-checked at compile time.

## Error Handling

It is recommended to wrap `invokeServiceAction` in a `try...catch` block and display any errors to the user using toasts. The function will throw an `Error` object with a user-friendly message.

```typescript
import { toast } from 'sonner';

try {
  await invokeServiceAction(/* ... */);
} catch (error) {
  if (error instanceof Error) {
    toast.error(error.message);
  }
}
```

## Finding available services and actions

The available `serviceName` and `action` values can be found in the generated file `@/lib/generated/api-schemas.ts`. This file is generated by the `backend/scripts/generate-api.ts` script.

The `apiSchemas` object in this file contains a list of all available services and their actions.

## Understanding the expected payload

The `@/lib/generated/api-schemas.ts` file also contains the JSON schema for the expected payload for each action. This can be used as a reference when building the payload for a service action.

### Key Payload Rules

1.  **Create Actions**: For any `create` action, you do not need to provide the `id` or other UUID fields. These are generated by the backend. The generated TypeScript types may include them, but they should be omitted from the payload object you pass to `invokeServiceAction`.
2.  **No Validation**: If an action has `null` for its `validation` property in the schema, it means no payload is expected. You should pass an empty object `{}` as the payload.

### Example: Create a Subscription Plan

Let's look at the `create` action for the `subscription-plans` service.

```typescript
// @/lib/generated/api-schemas.ts

export const apiSchemas = {
  "subscription-plans": [
    {
      "name": "create",
      "description": "Create a new record in subscriptionPlans",
      "validation": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "price": { "type": "integer" },
          "currency": { "type": "string" },
          "billingCycle": { "type": "string" },
          // ... other fields
        },
        "required": [ "id", "name", "price", /* ... */ ],
        // ...
      },
      // ...
    },
    // ...
  ],
  // ...
};
```

Even though `id` is listed in the schema, it should be omitted from the payload for a `create` action. Here's how you would call it:

```typescript
await invokeServiceAction({
  serviceName: 'subscription-plans',
  action: 'create',
  payload: {
    name: 'Basic Plan',
    price: 1000,
    currency: 'USD',
    billingCycle: 'monthly',
    // ... other required fields except for the UUID 'id'
  },
});
```